<div class="card card-dark">
  <div class="card-body">
    <h5 class="card-title text-primary spacing-xl">
      {{ report ? 'Edit Report' : 'Create Field Report' }}
    </h5>

    <form (ngSubmit)="onSubmit()">
      <!-- Map Selection -->
      <div class="spacing-md">
        <label for="map" class="form-label text-primary">Map</label>
        <select
          class="form-select"
          id="map"
          [(ngModel)]="selectedMapIdForm"
          name="map"
          (change)="onMapChange()"
          required
        >
          <option value="">Select a map</option>
          <option *ngFor="let map of maps" [value]="map._id">
            {{ map.name }}
          </option>
        </select>
      </div>

      <!-- Map Modifier -->
      <div class="spacing-md">
        <label for="mapModifiers" class="form-label text-primary">Map Modifier</label>
        <select
          class="form-select"
          id="mapModifiers"
          [(ngModel)]="mapModifiers"
          name="mapModifiers"
        >
          <option value="">Select a map modifier</option>
          <option *ngFor="let modifier of availableModifiers" [value]="modifier">
            {{ modifier }}
          </option>
        </select>
      </div>

      <!-- Time in Raid -->
      <div class="spacing-md">
        <label for="timeInRaid" class="form-label text-primary">Time in Raid (minutes)</label>
        <input
          type="number"
          class="form-control"
          id="timeInRaid"
          [(ngModel)]="timeInRaid"
          name="timeInRaid"
          min="0"
          max="45"
          required
        />
      </div>

      <!-- Raiders Encounters -->
      <div class="spacing-md">
        <label class="form-label text-primary">Raiders Encountered</label>
        <div *ngFor="let raider of raiders; let i = index" class="card encounter-box spacing-md">
          <div class="card-body">
            <div class="flex-between spacing-sm">
              <h6 class="text-primary">Raider #{{ i + 1 }}</h6>
              <button
                type="button"
                class="btn btn-sm btn-danger"
                (click)="removeRaiderEncounter(i)"
                *ngIf="raiders.length > 1"
              >
                Remove
              </button>
            </div>

            <div class="spacing-sm">
              <label [for]="'name' + i" class="form-label text-secondary">Name *</label>
              <input
                type="text"
                class="form-control"
                [id]="'name' + i"
                [(ngModel)]="raider.name"
                [name]="'name' + i"
                required
              />
            </div>

            <div class="spacing-sm">
              <label [for]="'embarkId' + i" class="form-label text-secondary"
                >Embark ID (optional)</label
              >
              <input
                type="text"
                class="form-control"
                [id]="'embarkId' + i"
                [(ngModel)]="raider.embarkId"
                [name]="'embarkId' + i"
              />
            </div>

            <div class="spacing-sm">
              <label [for]="'disposition' + i" class="form-label text-secondary">Disposition</label>
              <select
                class="form-select"
                [id]="'disposition' + i"
                [(ngModel)]="raider.disposition"
                [name]="'disposition' + i"
              >
                <option value="friendly">Friendly</option>
                <option value="skittish">Skittish</option>
                <option value="unfriendly">Unfriendly</option>
              </select>
            </div>

            <div class="spacing-sm">
              <label [for]="'picturePath' + i" class="form-label text-secondary"
                >Picture Path (optional)</label
              >
              <input
                type="text"
                class="form-control"
                [id]="'picturePath' + i"
                [(ngModel)]="raider.picturePath"
                [name]="'picturePath' + i"
                placeholder="/assets/images/raiders/default-raider.png"
              />
            </div>

            <div class="spacing-sm">
              <label [for]="'fieldNotes' + i" class="form-label text-secondary"
                >Field Notes (optional)</label
              >
              <textarea
                class="form-control"
                [id]="'fieldNotes' + i"
                [(ngModel)]="raider.fieldNotes"
                [name]="'fieldNotes' + i"
                rows="3"
              ></textarea>
            </div>
          </div>
        </div>

        <button type="button" class="btn btn-primary spacing-md" (click)="addRaiderEncounter()">
          Add Another Raider
        </button>
      </div>

      <!-- Form Actions -->
      <div class="flex-gap">
        <button type="submit" class="btn btn-success">
          {{ report ? 'Update Report' : 'Submit Report' }}
        </button>
        <button type="button" class="btn btn-secondary" (click)="onCancel()">Cancel</button>
      </div>
    </form>
  </div>
</div>
